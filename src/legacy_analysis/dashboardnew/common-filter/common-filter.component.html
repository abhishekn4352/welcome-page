<div class="common-filter-container">
  <!-- Filter Header -->
  <div class="filter-header">
    <h4>Common Filters</h4>
    <button class="btn btn-sm btn-primary" (click)="addFilter()">
      <clr-icon shape="plus"></clr-icon> Add Filter
    </button>
  </div>

  <!-- Presets Section -->
  <div class="presets-section" *ngIf="presets.length > 0">
    <div class="preset-controls">
      <select [(ngModel)]="activePreset" (change)="loadPreset(activePreset || '')" class="clr-select">
        <option value="">Select Preset</option>
        <option *ngFor="let preset of presets" [value]="preset">{{ preset }}</option>
      </select>
      <button class="btn btn-sm btn-danger" (click)="resetFilters()">
        <clr-icon shape="undo"></clr-icon> Reset
      </button>
    </div>
  </div>

  <!-- Save Preset Section -->
  <div class="save-preset-section">
    <div class="clr-input-group">
      <input type="text" [(ngModel)]="newPresetName" placeholder="Preset name" class="clr-input">
      <div class="clr-input-group-btn">
        <button class="btn btn-sm btn-success" (click)="savePreset()" [disabled]="!newPresetName.trim()">
          <clr-icon shape="floppy"></clr-icon> Save Preset
        </button>
      </div>
    </div>
  </div>

  <!-- Filters Form -->
  <form [formGroup]="filterForm" class="filters-form">
    <div class="filters-grid">
      <div *ngFor="let filter of filters" class="filter-item">
        <div class="filter-header">
          <span class="filter-label">{{ filter.label }}</span>
          <button class="btn btn-icon btn-danger btn-sm" (click)="removeFilter(filter.id)">
            <clr-icon shape="trash"></clr-icon>
          </button>
        </div>

        <!-- Filter Type Selector -->
        <div class="clr-form-control">
          <select [(ngModel)]="filter.type" (ngModelChange)="updateFilter(filter.id, 'type', $event)" 
                  [ngModelOptions]="{standalone: true}" class="clr-select filter-type-select">
            <option value="text">Text</option>
            <option value="dropdown">Dropdown</option>
            <option value="multiselect">Multi-Select</option>
            <option value="date-range">Date Range</option>
            <option value="toggle">Toggle</option>
          </select>
        </div>

        <!-- Filter Label Input -->
        <div class="clr-form-control">
          <input type="text" [(ngModel)]="filter.label" (ngModelChange)="updateFilter(filter.id, 'label', $event)" 
                 [ngModelOptions]="{standalone: true}" placeholder="Filter Label" class="clr-input">
        </div>

        <!-- Filter Field Input -->
        <div class="clr-form-control">
          <input type="text" [(ngModel)]="filter.field" (ngModelChange)="updateFilter(filter.id, 'field', $event)" 
                 [ngModelOptions]="{standalone: true}" placeholder="Field Name" class="clr-input">
        </div>

        <!-- Filter Options (for dropdown and multiselect) -->
        <div class="clr-form-control" *ngIf="filter.type === 'dropdown' || filter.type === 'multiselect'">
          <textarea [(ngModel)]="filter.options" (ngModelChange)="updateFilter(filter.id, 'options', $event ? $event.split(',') : [])" 
                    [ngModelOptions]="{standalone: true}" placeholder="Options (comma separated)" class="clr-textarea"></textarea>
        </div>

        <!-- Filter Controls Based on Type -->
        <div class="filter-control" [ngSwitch]="filter.type">
          <!-- Text Filter -->
          <div *ngSwitchCase="'text'">
            <input type="text" [formControlName]="filter.id" placeholder="Enter text" class="clr-input">
          </div>

          <!-- Dropdown Filter -->
          <div *ngSwitchCase="'dropdown'">
            <select [formControlName]="filter.id" class="clr-select">
              <option value="">Select an option</option>
              <option *ngFor="let option of filter.options" [value]="option">{{ option }}</option>
            </select>
          </div>

          <!-- Multi-Select Filter -->
          <div *ngSwitchCase="'multiselect'">
            <select [formControlName]="filter.id" multiple class="clr-select multiselect">
              <option *ngFor="let option of filter.options" [value]="option">{{ option }}</option>
            </select>
          </div>

          <!-- Date Range Filter -->
          <div *ngSwitchCase="'date-range'" class="date-range-controls">
            <div class="clr-form-control">
              <label>Start Date</label>
              <input type="date" [ngModel]="filterForm.get(filter.id + '.start')?.value" 
                     (ngModelChange)="onDateRangeChange(filter.id, { start: $event, end: filterForm.get(filter.id + '.end')?.value })" 
                     [ngModelOptions]="{standalone: true}" class="clr-input">
            </div>
            <div class="clr-form-control">
              <label>End Date</label>
              <input type="date" [ngModel]="filterForm.get(filter.id + '.end')?.value" 
                     (ngModelChange)="onDateRangeChange(filter.id, { start: filterForm.get(filter.id + '.start')?.value, end: $event })" 
                     [ngModelOptions]="{standalone: true}" class="clr-input">
            </div>
          </div>

          <!-- Toggle Filter -->
          <div *ngSwitchCase="'toggle'" class="toggle-control">
            <input type="checkbox" [formControlName]="filter.id" clrToggle class="clr-toggle">
            <label>{{ filter.label }}</label>
          </div>
        </div>
      </div>
    </div>
  </form>

  <!-- No Filters Message -->
  <div class="no-filters" *ngIf="filters.length === 0">
    <p>No filters added yet. Click "Add Filter" to create your first filter.</p>
  </div>
</div>